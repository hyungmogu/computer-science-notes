\documentclass[12pt]{article}
\usepackage[margin=2.5cm]{geometry}
\usepackage{enumerate}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{fancyhdr}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mdframed}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{adjustbox}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{booktabs}
\usepackage[utf]{kotex}
\usepackage{hyperref}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=1
}

\lstset{style=mystyle}

\pagestyle{fancy}
\renewcommand{\headrulewidth}{0.4pt}
\lhead{Team Treehouse}
\rhead{Querying Relational Databases Part 6 Notes}

\begin{document}
\title{Querying Relational Databases Part 6 Notes}
\author{Team Treehouse}
\maketitle

\bigskip

\section{What are Subqueries}

\bigskip

\begin{itemize}
    \item is used to return data that will be used in the main query as a condition
    \item is embedded within the WHERE clause
    \item Use cases
    \begin{itemize}
        \item Criteria for a where clause is not specifically known
        \item Need a temporary dataset to join with other tables in your database
    \end{itemize}
\end{itemize}

\bigskip

\section{Using IN with Subqueries to Filter Data}

\bigskip

\begin{itemize}
    \item \textbf{Syntax:} SELECT \textit{columns name} FROM \textit{table 1 name}
    WHERE \textit{Column 1 name} IN (SELECT \textit{Column 1 Name} FROM \textit{table 2 name}
    WHERE \textit{Search Criteria})

    \item \textbf{Syntax 2:} SELECT \textit{columns name} FROM \textit{table 1 name}
    WHERE \textit{Column 1 name} NOT IN (SELECT \textit{Column 1 Name} FROM \textit{table 2 name}
    WHERE \textit{Search Criteria})

    \bigskip

    \underline{\textbf{Example:}}

    \bigskip

    \begin{lstlisting}[language=SQL]
    SELECT * FROM Sale WHERE CarID NOT IN (SELECT CarID FROM Car WHERE ModelYear = 2015);
    \end{lstlisting}
\end{itemize}

\bigskip

\section{Using a Subquery to Create a Temporary Table (Part 1)}

\bigskip


\begin{itemize}
    \item Temporary table is also called a \textbf{derived table}
    \item Is used in INNER JOIN and OUTER JOIN
    \item \textbf{Syntax:}

    SELECT \textit{Columns Name}

    FROM \textit{Table name}

    \textit{INNER / OUTER} JOIN

    (SELECT \textit{columns name} FROM \textit{table name} WHERE \textit{Search Criteria}) AS \textit{Alias}

    ON \textit{Join Criteria};

    \bigskip

    \underline{\textbf{Example:}}

    \bigskip

    \begin{lstlisting}[language=SQL]
    SELECT * FROM Sale AS s
        INNER JOIN (SELECT CarID FROM Car WHERE ModelYear = 2015) AS t
        ON s.CarID = t.CarID;
    \end{lstlisting}
\end{itemize}

\bigskip

\section{Using a Subquery to Create a Temporary Table (Part 2)}

\bigskip


\begin{itemize}
    \item Note: Always work on subqueries before working more complex query
    \item \textbf{Derived table} or \textbf{temporary table} can also be used in JOINS

    \begin{lstlisting}[language=SQL]
    // ===== create subqueries =======

    SELECT SalesRepID, SUM(SaleAmount) AS StLouisAmount
    FROM Sales AS s WHERE s.LocationID = 1
    GROUP BY SalesRepID;


    SELECT SalesRepID, SUM(SaleAmount) AS ColumbiaAmount
    FROM Sales AS s WHERE s.LocationID = 2
    GROUP BY SalesRepID;

    // ===== Add to main query ======

    SELECT sr.LastName FROM SalesRep AS sr
        LEFT OUTER JOIN (
            SELECT SalesRepID, SUM(SaleAmount) AS StLouisAmount
            FROM Sale AS s WHERE s.LocationID = 1
            GROUP BY SalesRepID;
        ) As Loc1

        LEFT OUTER JOIN (
            SELECT SalesRepID, SUM(SaleAmount) AS ColumbiaAmount
            FROM Sale AS s WHERE s.LocationID = 2
            GROUP BY SalesRepID;
        ) AS Loc2


    // ===== Finish by adding join criteria ======

    SELECT sr.LastName, Loc1.StLouisAmount, Loc2.ColumbiaAmount FROM SalesRep AS sr
        LEFT OUTER JOIN (
            SELECT SalesRepID, SUM(SaleAmount) AS StLouisAmount
            FROM Sale AS s WHERE s.LocationID = 1
            GROUP BY SalesRepID;
        ) As Loc1 ON sr.SalesRepID = Loc1.SalesRepID

        LEFT OUTER JOIN (
            SELECT SalesRepID, SUM(SaleAmount) AS ColumbiaAmount
            FROM Sale AS s WHERE s.LocationID = 2
            GROUP BY SalesRepID;
        ) AS Loc2 ON sr.SalesRepID = Loc2.SalesRepID


    \end{lstlisting}
\end{itemize}

\bigskip

\section{Subqueries Review}

\bigskip

\begin{enumerate}[1.]
    \item

    When using a subquery to filter your outer query, you use what SQL keyword?

    \begin{enumerate}[A.]
        \item AS
        \item IN
        \item OF
        \item ON
    \end{enumerate}

    \bigskip

    \textbf{Answer:} B

    \item

    Why must a derived table be aliased?

    \begin{enumerate}[A.]
        \item The database wouldn’t be able to tell which user is running the query otherwise.
        \item Being a temporary object, it has no other name and thus the database wouldn’t be able to reference its resulting data set.
        \item They do not need to be aliased.

    \end{enumerate}

    \bigskip

    \textbf{Answer:} B

    \item

    When creating derived / temporary tables, your subquery belongs in which
    section of the query:

    \begin{enumerate}[A.]
        \item WHERE
        \item GROUP BY
        \item FROM
        \item SELECT
    \end{enumerate}

    \bigskip

    \textbf{Answer:} C

    \item

    When using a subquery to create a derived table, you can only select ONE
    column in the Subquery.

    \begin{enumerate}[A.]
        \item True
        \item False
    \end{enumerate}

    \bigskip

    \textbf{Answer:} B


    \item

    When using IN with a subquery, you can only select ONE column in the Subquery.

    \begin{enumerate}[A.]
        \item True
        \item False
    \end{enumerate}

    \bigskip

    \textbf{Answer:} A

\end{enumerate}


\end{document}