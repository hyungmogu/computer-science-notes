\documentclass[12pt]{article}
\usepackage[margin=2.5cm]{geometry}
\usepackage{enumerate}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{fancyhdr}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mdframed}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{adjustbox}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{booktabs}
\usepackage[utf]{kotex}
\usepackage{hyperref}
\usepackage{accents}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=1
}

\lstset{style=mystyle}

\pagestyle{fancy}
\renewcommand{\headrulewidth}{0.4pt}
\lhead{CSC 343}
\rhead{Worksheet 5}

\begin{document}
\title{CSC343 Worksheet 5}
\maketitle

\begin{enumerate}[1.]
    \item \textbf{Exercise 7.1.1:} Our running example movie database of Section
    2.2.8 has keys defined for all its relations.

    \begin{lstlisting}[language=SQL]
    Movies(title, year, length, genre, studioName, producerC#)
    Starsln(movieTitle, movieYear, starName)
    MovieStar(name, address, gender, birthdate)
    MovieExec(name, address, cert#, netWorth)
    Studio(name, address, presC#)
    \end{lstlisting}

    \bigskip

    Declare the following referential integrity constraints for the movie database as
    in Exercise 7.1.1.

    \begin{enumerate}[a)]
        \item The producer of a movie must be someone mentioned in MovieExec. Modifications to MovieExec that violate this constraint are rejected.
        \item Repeat (a), but violations result in the producerC\# in Movie being set to NULL.
        \item Repeat (a), but violations result in the deletion or update of the offending Movie tuple.
        \item A movie that appears in Stars ln must also appear in Movie. Handle violations by rejecting the modification.
        \item A star appearing in Stars ln must also appear in MovieStar. Handle violations by deleting violating tuples.
    \end{enumerate}

    \item \textbf{Exercise 7.1.2:} We would like to declare the constraint that every movie in
    the relation Movie must appear with at least one star in StarsIn. Can we do
    so with a foreign-key constraint? Why or why not?

    \item \textbf{Exercise 7.1.3:} Suggest suitable keys and foreign keys for the relations of the
    PC database:

    \begin{lstlisting}[language=SQL]
    Product(maker, model, type)
    PC(model, speed, ram, hd, price)
    Laptop(model, speed, ram, hd, screen, price)
    Printer(model, color, type, price)
    \end{lstlisting}

    \bigskip

    of Exercise 2.4.1. Modify your SQL schema from Exercise 2.3.1 to include
    declarations of these keys.

    \item \textbf{Exercise 7.1.4:} Suggest suitable keys for the relations of the battleships
    database

    \bigskip

    \begin{lstlisting}[language=SQL]
    Classes(class, type, country, numGuns, bore, displacement)
    Ships(name, class, launched)
    Battles(name, date)
    Outcomes(ship, battle, result)
    \end{lstlisting}

    \bigskip

    of Exercise 2.4.3. Modify your SQL schema from Exercise 2.3.2 to include
    declarations of these keys.

    \item \textbf{Exercise 7.1.5:} Exercise 7.1.5: Write the following referential
    integrity constraints for the battleships database as in Exercise 7.1.4. Use
    your assumptions about keys from that exercise, and handle all violations by
    setting the referencing attribute value to NULL

    \begin{enumerate}[a)]
        \item Every class mentioned in \textbf{Ships} must be mentioned in \textbf{Classes}.
        \item Every battle mentioned in \textbf{Outcomes} must be mentioned in \textbf{Battles}.
        \item Every ship mentioned in \textbf{Outcomes} must be mentioned in \textbf{Ships}.
    \end{enumerate}

    \item \textbf{Exercise 7.2.1:} Write the following constraints for attributes of the relation

    \begin{lstlisting}[language=SQL]
    Movies(title, year, length, genre, studioName, producerC#)
    \end{lstlisting}

    \bigskip

    \begin{enumerate}[a)]
        \item The year cannot be before 1915.
        \item The length cannot be less than 60 nor more than 250.
        \item The studio name can only be Disney, Fox, MGM, or Paramount.
    \end{enumerate}

    \item \textbf{Exercise 7.2.2:} Write the following constraints on attributes from our example
    schema

    \begin{lstlisting}[language=SQL]
    Product(maker, model, type)
    PC(model, speed, ram, hd, price)
    Laptop(model, speed, ram, hd, screen, price)
    Printer(model, color, type, price)
    \end{lstlisting}

    \bigskip

    of Exercise 2.4.1.

    \bigskip

    \begin{enumerate}[a)]
        \item The speed of a laptop must be at least 2.0.
        \item The only types of printers are laser, ink-jet, and bubble-jet.
        \item The only types of products are PC’s, laptops, and printers.
        \item A model of a product must also be the model of a PC, a laptop, or a printer.
    \end{enumerate}

    \item \textbf{Exercise 7.2.3:} Write the following constraints as tuple-based CHECK constraints
    on one of the relations of our running movies example:

    \begin{lstlisting}[language=SQL]
    Movies(title, year, length, genre, studioName, producerC#)
    Starsln(movieTitle, movieYear, starName)
    MovieStar(name, address, gender, birthdate)
    MovieExec(name, address, cert#, netWorth)
    Studio(name, address, presC#)
    \end{lstlisting}

    \bigskip

    If the constraint actually involves two relations, then you should put constraints
    in both relations so that whichever relation changes, the constraint will be
    checked on insertions and updates. Assume no deletions; it is not always possible
    to maintain tuple-based constraints in the face of deletions.

    \bigskip

    \begin{enumerate}[a)]
        \item A star may not appear in a movie made before they were born.
        \item No two studios may have the same address.
        \item A name that appears in \textbf{MovieStar} must not also appear in \textbf{MovieExec}.
        \item A studio name that appears in \textbf{Studio} must also appear in at least one \textbf{Movies} tuple.
    \end{enumerate}

    \item \textbf{Exercise 7.2.4:} Write the following as tuple-based CHECK constraints about
    our 'PC' schema.

    \bigskip

    \begin{enumerate}[a)]
        \item A PC with a processor speed less than 2.0 must not sell for more than \$600.
        \item A laptop with a screen size less than 15 inches must have at least a 40 gigabyte hard disk or sell for less than \$1000.
    \end{enumerate}

    \item \textbf{Exercise 7.2.5:} Write the following as tuple-based CHECK constraints about
    our 'battleships' schema:

    \bigskip

    \begin{lstlisting}[language=SQL]
    Classes(class, type, country, numGuns, bore, displacement)
    Ships(name, class, launched)
    Battles(name, date)
    Outcomes(ship, battle, result)
    \end{lstlisting}

    \begin{enumerate}[a)]
        \item No class of ships may have guns with larger than a 16-inch bore.
        \item If a class of ships has more than 9 guns, then their bore must be no larger than 14 inches.
        \item No ship can be in battle before it is launched.
    \end{enumerate}

    \item \textbf{Exercise 7.2.6:} In Examples 7.6 and 7.8, we introduced constraints on the
    gender attribute of \textbf{MovieStar}. What restrictions, if any, do each of these constraints
    enforce if the value of gender is NULL?

    \item \textbf{Exercise 7.3.1:} E xercise 7.3.1: Show how to alter your relation
    schemas for the movie example:

    \bigskip

    \begin{lstlisting}[language=SQL]
    Movies(title, year, length, genre, studioName, producerC#)
    Starsln(movieTitle, movieYear, starName)
    MovieStar(name, address, gender, birthdate)
    MovieExec(name, address, cert#, netWorth)
    Studio(name, address, presC#)
    \end{lstlisting}

    \bigskip

    in the following ways.

    \bigskip

    \begin{enumerate}[a)]
        \item Make title and year the key for \textbf{Movie}.
        \item Require the referential integrity constraint that the producer of every movie appear in \textbf{MovieExec}.
        \item Require that no movie length be less than 60 nor greater than 250.
        \item Require that no name appear as both a movie star and movie executive (this constraint need not be maintained in the face of deletions).
        \item Require that no two studios have the same address.
    \end{enumerate}

    \item \textbf{Exercise 7.3.2:} Show how to alter the schemas of the “battleships”
    database:

    \bigskip

    \begin{lstlisting}[language=SQL]
    Classes(class, type, country, numGuns, bore, displacement)
    Ships(name, class, launched)
    Battles(name, date)
    Outcomes(ship, battle, result)
    \end{lstlisting}

    \bigskip

    to have the following tuple-based constraints.

    \bigskip

    \begin{enumerate}[a)]
        \item \textbf{Class} and country form a key for relation \textbf{Classes}.
        \item Require the referential integrity constraint that every battle appearing in \textbf{Outcomes} also appears in \textbf{Battles}.
        \item Require the referential integrity constraint that every ship appearing in \textbf{Outcomes} appears in \textbf{Ships}.
        \item Require that no ship has more than 14 guns.
        \item Disallow a ship being in battle before it is launched.
    \end{enumerate}

    \item \textbf{Exercise 7.4.1:} Write the following assertions. The database schema is from
    the 'PC' example of Exercise 2.4.1:


    \begin{lstlisting}[language=SQL]
    Product(maker, model, type)
    PC(model, speed, ram, hd, price)
    Laptop(model, speed, ram, hd, screen, price)
    Printer(model, color, type, price)
    \end{lstlisting}

    \bigskip

    \begin{enumerate}[a)]
        \item No manufacturer of PC's may also make laptops.

        \begin{center}
        \includegraphics[width=0.7\linewidth]{images/worksheet_5_1.png}
        \end{center}

        \item A manufacturer of a PC must also make a laptop with at least as great a processor speed.
        \item If a laptop has a larger main memory than a PC, then the laptop must also have a higher price than the PC.
        \item If the relation \textbf{Product} mentions a model and its type, then this model must appear in the relation appropriate to that type.
    \end{enumerate}

    \item \textbf{Exercise 7.4.2:} Write the following as assertions. The
    database schema is from the battleships example of Exercise 2.4.3.

    \bigskip

    \begin{lstlisting}[language=SQL]
    Classes(class, type, country, numGuns, bore, displacement)
    Ships(name, class, launched)
    Battles(name, date)
    Outcomes(ship, battle, result)
    \end{lstlisting}

    \bigskip

    \begin{enumerate}[a)]
        \item No class may have more than 2 ships.
        \item No country may have both battleships and battlecruisers.
        \item No ship with more than 9 guns may be in a battle with a ship having fewer than 9 guns that was sunk.
        \item No ship may be launched before the ship that bears the name of the first ship’s class.
        \item For every class, there is a ship with the name of that class.
    \end{enumerate}

    \item \textbf{Exercise 7.4.3:} The assertion of Exercise 7.11 can be written as two tuplebased
    constraints. Show how to do so.

    \item \textbf{Exercise 7.5.1:} Write the triggers analogous to Fig. 7.6 for the insertion and
    deletion events on \textbf{MovieExec}.

    \item \textbf{Exercise 7.5.2:} Write the following as triggers. In each case, disallow or
    undo the modification if it does not satisfy the stated constraint. The database
    schema is from the 'PC' example of Exercise 2.4.1:

    \begin{lstlisting}[language=SQL]
    Product(maker, model, type)
    PC(model, speed, ram, hd, price)
    Laptop(model, speed, ram, hd, screen, price)
    Printer(model, color, type, price)
    \end{lstlisting}

    \bigskip

    \begin{enumerate}[a)]
        \item When updating the price of a PC, check that there is no lower priced PC with the same speed.
        \item When inserting a new printer, check that the model number exists in Product.
        \item When making any modification to the Laptop relation, check that the average price of laptops for each manufacturer is at least \$1500.
        \item When updating the RAM or hard disk of any PC, check that the updated PC has at least 100 times as much hard disk as RAM.
        \item When inserting a new PC, laptop, or printer, make sure that the model number did not previously appear in any of PC, Laptop, or P rin te r.
    \end{enumerate}

    \item \textbf{Exercise 7.5.3:} Write the following as triggers. In each case, disallow or
    undo the modification if it does not satisfy the stated constraint. The database
    schema is from the battleships example of Exercise 2.4.3.

    \bigskip

    \begin{lstlisting}[language=SQL]
    Classes(class, type, country, numGuns, bore, displacement)
    Ships(name, class, launched)
    Battles(name, date)
    Outcomes(ship, battle, result)
    \end{lstlisting}

    \bigskip

    \begin{enumerate}[a)]
        \item When a new class is inserted into \textbf{Classes}, also insert a ship with the name of that class and a NULL launch date.
        \item When a new class is inserted with a displacement greater than 35,000 tons, allow the insertion, but change the displacement to 35,000.
        \item If a tuple is inserted into \textbf{Outcomes}, check that the ship and battle are listed in \textbf{Ships} and \textbf{Battles} , respectively, and if not, insert tuples into one or both of these relations, with NULL components where necessary.
        \item When there is an insertion into \textbf{Ships} or an update of the c la s s attribute of \textbf{Ships}, check that no country has more than 20 ships.
    \end{enumerate}
\end{enumerate}

\end{document}