\documentclass[12pt]{article}
\usepackage[margin=2.5cm]{geometry}
\usepackage{enumerate}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{fancyhdr}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mdframed}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{adjustbox}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{booktabs}
\usepackage[utf]{kotex}
\usepackage{hyperref}
\usepackage{accents}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=1
}

\lstset{style=mystyle}

\pagestyle{fancy}
\renewcommand{\headrulewidth}{0.4pt}
\lhead{CSC 343}
\rhead{Worksheet 6}

\begin{document}
\title{CSC343 Worksheet 6}
\maketitle

\begin{enumerate}[1.]
    \item \textbf{Exercise 6.6.1:} This and the next exercises involve certain
    programs that operate on the two relations

    \begin{lstlisting}[language=SQL]
    Product(maker, model, type)
    PC(model, speed, ram, hd, price)
    \end{lstlisting}

    \bigskip

    from our running PC exercise. Sketch the following programs, including SQL
    statements and work done in a conventional language. Do not forget to issue
    BEGIN TRANSACTION, COMMIT, and ROLLBACK statements at the proper times
    and to tell the system your transactions are read-only if they are.

    \bigskip

    \begin{itemize}
        \item Given a speed and amount of RAM (as arguments of the function), look up the PC ’s with that speed and RAM, printing the model number and price of each.
        \item Given a model number, delete the tuple for that model from both PC and Product.
        \item Given a model number, decrease the price of that model PC by \$100.
        \item Given a maker, model number, processor speed, RAM size, hard-disk size, and price, check that there is no product with that model. If there is such a model, print an error message for the user. If no such model existed in the database, enter the information about that model into the PC and Product tables.
    \end{itemize}

    \item \textbf{Exercise 6.6.2:} For each of the programs of Exercise 6.6.1,
    discuss the atomicity problems, if any, that could occur should the system crash
    in the middle of an execution of the program.

    \item \textbf{Exercise 6.6.3:} Suppose we execute as a transaction T one of the four programs
    of Exercise 6.6.1, while other transactions that are executions of the same
    or a different one of the four programs may also be executing at about the same
    time. What behaviors of transaction T may be observed if all the transactions
    run with isolation level READ UNCOMMITTED that would not be possible if they
    all ran with isolation level SERIALIZABLE? Consider separately the case that T
    is any of the programs (a) through (d) of Exercise 6.6.1.

    \item \textbf{Exercise 8.1.1:} From the following base tables of our running
    example

    \bigskip

    \begin{lstlisting}[language=SQL]
    MovieStar(name, address, gender, birthdate)
    MovieExec(name, address, cert# , netWorth)
    Studio(name, address, presC#)
    \end{lstlisting}

    \bigskip

    Construct the following views

    \bigskip

    \begin{itemize}
        \item A view RichExec giving the name, address, certificate number and networth of all executives with a net worth of at least \$10,000,000.
        \item A view StudioPres giving the name, address, and certificate number of all executives who are studio presidents.
        \item A view ExecutiveStar giving the name, address, gender, birth date, certificat number, and net worth of all individuals who are both executives and stars.
    \end{itemize}


    \item \textbf{Exercise 8.1.2:} Write each of the queries below, using one or more of the
    views from Exercise 8.1.1 and no base tables.

    \bigskip

    \begin{itemize}
        \item Find the names of females who are both stars and executives.
        \item Find the names of those executives who are both studio presidents and worth at least \$10,000,000.
        \item Find the names of studio presidents who are also stars and are worth at least \$50,000,000.
    \end{itemize}

    \item \textbf{Exercise 8.2.1:} Which of the views of Exercise 8.1.1 are updatable?
    \item \textbf{Exercise 8.2.2:} Suppose we create the view:

    \begin{lstlisting}[language=SQL]
    CREATE VIEW DisneyComedies AS
    SELECT title ,year, length FROM Movies
    WHERE studioName = 'Disney' AND genre = 'comedy';
    \end{lstlisting}

    \bigskip

    \begin{itemize}
        \item Is this view updatable?
        \item Write an instead-of trigger to handle an insertion into this view.
        \item Write an instead-of trigger to handle an update of the length for a movie (given by title and year) in this view.
    \end{itemize}

    \item \textbf{Exercise 8.2.3:} Using the base tables

    \bigskip

    \begin{lstlisting}[language=SQL]
    Product(m aker, model, type)
    PC(model, speed, ram, hd, price )
    \end{lstlisting}

    \bigskip

    suppose we create the view

    \bigskip

    \begin{lstlisting}[language=SQL]
    CREATE VIEW NewPC AS
    SELECT maker, model, speed, ram, hd, price
    FROM Product, PC
    WHERE Product.model = PC.model AND type = 'pc';
    \end{lstlisting}

    \bigskip

    Notice that we have made a check for consistency: that the model number not
    only appears in the PC relation, but the ty p e attribute of Product indicates
    that the product is a PC.

    \bigskip

    \begin{itemize}
        \item Is this view updatable?
        \item Write an instead-of trigger to handle an insertion into this view.
        \item Write an instead-of trigger to handle an update of the price.
        \item Write an instead-of trigger to handle a deletion of a specified tuple from this view.
    \end{itemize}

    \item \textbf{Exercise 8.3.1:} For our running movies example:

    \bigskip

    \begin{lstlisting}[language=SQL]
    Movies(title, year, length, genre, studioName, producerC\#)
    StarsIn(movieTitle, movieYear, starName)
    MovieExec(name, address, cert\#, netWorth)
    Studio(name, address, presC\#)
    \end{lstlisting}

    \bigskip

    Declare indexes on the following attributes or combination of attributes:

    \bigskip

    \begin{itemize}
        \item studioName.
        \item address of MovieExec.
        \item genre and length.
    \end{itemize}

    \item \textbf{Exercise 8.4.1:} Suppose that the relation StarsIn discussed in Example 8.14
    required 100 pages rather than 10, but all other assumptions of that example
    continued to hold. Give formulas in terms of pi and p? to measure the cost of
    queries Q\ and Q2 and insertion I, under the four combinations of index/no index
    discussed there.

    \item \textbf{Exercise 8.4.2:} In this problem, we consider indexes for the relation

    \bigskip

    \begin{lstlisting}[language=SQL]
    Ships(name, class, launched)
    \end{lstlisting}

    \bigskip

    from our running battleships exercise. Assume:

    \bigskip

    \begin{enumerate}[i.]
    \item name is the key.
    \item The relation Ships is stored over 50 pages.
    \item The relation is clustered on class so we expect that only one disk access is needed to find the ships of a given class.
    \item On average, there are 5 ships of a class, and 25 ships launched in any given year.
    \item With probability p\ the operation on this relation is a query of the form SELECT * FROM Ships WHERE name = n.
    \item With probability p2 the operation on this relation is a query of the form SELECT * FROM Ships WHERE class = c.
    \item With probability pz the operation on this relation is a query of the form SELECT * FROM Ships WHERE launched = y.
    \item With probability 1 — pi — p2 — P3 the operation on this relation is an
    insertion of a new tuple into Ships.
    \end{enumerate}

    \bigskip

    You can also make the assumptions about accessing indexes and finding empty space for insertions that were made in Example 8.14.

    \bigskip

    Consider the creation of indexes on name, class , and launched. For each
    combination of indexes, estimate the average cost of an operation. As a function
    of $p_1$, $p_2$, and $p_3$, what is the best choice of indexes?


    \item \textbf{Exercise 8.5.1:} Complete Example 8.15 by considering updates to either of
    the base tables.

    \item \textbf{Exercise 8.5.2:} Suppose the view NewPC of Exercise 8.2.3 were a materialized
    view. What modifications to the base tables Product and PC would require a
    modification of the materialized view? How would you implement those modifications
    incrementally?

    \item \textbf{Exercise 8.5.3:} This exercise explores materialized views that are based on
    aggregation of data. Suppose we build a materialized view on the base tables

    \bigskip

    \begin{lstlisting}[language=SQL]
    Classes(class, type, country, numGuns, bore, displacement)
    Ships(name, class, launched)
    \end{lstlisting}

    \bigskip

    from our running battleships exercise, as follows:

    \begin{lstlisting}[language=SQL]
    CREATE MATERIALIZED VIEW ShipStats AS
    SELECT country, AVG(displacement), COUNT(*)
    FROM Classes, Ships
    WHERE Classes.class = Ships.class
    GROUP BY country;
    \end{lstlisting}

    \bigskip

    What modifications to the base tables Classes and Ships would require a
    modification of the materialized view? How would you implement those modifications
    incrementally?

    \item \textbf{Exercise 8.5.4:} In Section 8.5.3 we gave conditions under which a materialized
    view of simple form could be used in the execution of a query of similar form.
    For the view of Example 8.15, describe all the queries of that form, for which
    this view could be used.

\end{enumerate}

\end{document}