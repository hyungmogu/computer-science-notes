\documentclass[12pt]{article}
\usepackage[margin=2.5cm]{geometry}
\usepackage{enumerate}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{fancyhdr}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mdframed}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{adjustbox}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{booktabs}
\usepackage[utf]{kotex}
\usepackage{hyperref}
\usepackage{accents}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=1
}

\lstset{style=mystyle}

\pagestyle{fancy}
\renewcommand{\headrulewidth}{0.4pt}
\lhead{CSC 343}
\rhead{Worksheet 5 Solution}

\begin{document}
\title{CSC343 Worksheet 5 Solution}
\maketitle

\begin{enumerate}[1.]
    \item

    \begin{enumerate}[a)]
        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE MovieExec (
        name CHAR(30),
        address VARCHAR(255),
        cert# INT PRIMARY KEY,
        FOREIGN KEY (cert#) REFERENCES Movies(producerC#)
    );
    \end{lstlisting}

        \bigskip

        \underline{\textbf{Example:}}

        \bigskip

        \begin{itemize}
            \item Foreign-key
            \begin{itemize}
                \item \textbf{Syntax 1:} FOREIGN KEY ($<\text{attributes}>$) REFERENCES $<\text{table}>$($<\text{attributes}>$)
                \item \textbf{Syntax 2:} REFERENCES $<\text{table}>$($<\text{attributes}>$)
                \item Binds an attribute of one relation to an anttribute in another table
                \item Added when creating table

                \bigskip

                \underline{\textbf{Example:}}

                \bigskip

    \begin{lstlisting}[language=SQL]
    // Example 1
    CREATE TABLE Studio (
        name CHAR(30) PRIMARY KEY,
        address VARCHAR(255),
        presC# INT REFERENCES MovieExeC(cert#)
    );

    // Example 2
    CREATE TABLE Studio (
        name CHAR(30) PRIMARY KEY,
        address VARCHAR(255),
        presC# INT,
        FOREIGN KEY (presC#) REFERENCES MovieExec(cert#)
    );
    \end{lstlisting}
            \end{itemize}
        \end{itemize}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Movies (
        title CHAR(30) PRIMARY KEY,
        year INT PRIMARY KEY,
        length INT,
        genre VARCHAR(255),
        studioName VARCHAR(255),
        producerC# PRIMARY KEY
    );
    \end{lstlisting}

        \item No change required. Violation occurs by the default policy.

    \begin{lstlisting}[language=SQL]
    CREATE TABLE MovieExec (
        name CHAR(30),
        address VARCHAR(255),
        cert# INT PRIMARY KEY,
        FOREIGN KEY (cert#) REFERENCES Movies(producerC#)
    );
    \end{lstlisting}

        \bigskip

        \begin{mdframed}
            \underline{\textbf{Correct Solution:}}

            \bigskip

    \begin{lstlisting}[language=SQL]
    CREATE TABLE MovieExec (
        name CHAR(30),
        address VARCHAR(255),
        cert# INT PRIMARY KEY,
        FOREIGN KEY (cert#) REFERENCES Movies(producerC#)
            ON UPDATE CASCADE // Correction
            ON DELETE CASCADE // Correction
    );
    \end{lstlisting}

        \end{mdframed}

        \bigskip

        \underline{\textbf{Notes:}}

        \bigskip

        \begin{itemize}
            \item Maintaining Referential Integrity
            \begin{itemize}
                \item Three different types of policies exist on Foreign Key
                \begin{enumerate}[1.]
                    \item \textit{The Default Policy:} \textit{Reject Violating Modifications.}
                    \begin{itemize}
                        \item Is default policy
                        \item Rejects any modification violating referential integrity constant
                    \end{itemize}
                    \item \textit{The Cascade Policy}
                    \begin{itemize}
                        \item Changes to the referenced attributes are mimicked at foreign key.
                        \item e.g. delete a tuple in \textbf{MovieExec}, deletes related
                        referencing tuple(s) from \textbf{Studio}
                    \end{itemize}
                    \item \textit{The Set-Null Policy}
                    \begin{itemize}
                        \item When a modification to the referenced relation affects a foreign-key
                        value, the latter is changed to NULL.
                        \item This applies to both UPDATE and DELETE
                    \end{itemize}
                \end{enumerate}
            \end{itemize}

            \bigskip

            \underline{\textbf{Example:}}

            \bigskip

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Movies (
        title CHAR(30) PRIMARY KEY,
        year INT PRIMARY KEY,
        length INT,
        genre VARCHAR(255),
        studioName VARCHAR(255),
        producerC# REFERENCES MovieExec(cert#)
            ON DELETE SET NULL
            ON UPDATE CASCADE
    );
    \end{lstlisting}
        \end{itemize}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Movies (
        title CHAR(30) PRIMARY KEY,
        year INT PRIMARY KEY,
        length INT,
        genre VARCHAR(255),
        studioName VARCHAR(255),
        producerC# VARCHAR(255)
        FOREIGN KEY (title) REFERENCES StarsIn(movieTitle)
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE StarsIn (
        movieTitle CHAR(30) PRIMARY KEY,
        movieYear INT PRIMARY KEY,
        starName VARCHAR(255) PRIMARY KEY,
        FOREIGN KEY (starName) REFERENCES MovieStar(name)
            ON DELETE CASCADE
    );
    \end{lstlisting}

    \end{enumerate}

    \item Yes. Set foreign-key constraint on StarsIn's movietitle to Movie's title.

    \bigskip

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Movies (
        title CHAR(30) PRIMARY KEY,
        year INT PRIMARY KEY,
        length INT,
        genre VARCHAR(255),
        studioName VARCHAR(255),
        producerC# VARCHAR(255),
        FOREIGN KEY (title) REFERENCES StarsIn(movieTitle)
    );
    \end{lstlisting}

    \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Product (
        maker CHAR(30),
        model INT PRIMARY KEY,
        type VARCHAR(255)
    );

    CREATE TABLE PC (
        model INT PRIMARY KEY,
        speed FLOAT,
        ram INT,
        hd INT,
        price FLOAT,
        FOREIGN KEY (model) REFERENCES Product(model)
    );

    CREATE TABLE Laptop (
        model INT PRIMARY KEY,
        speed FLOAT,
        ram INT,
        hd INT,
        screen INT,
        price FLOAT,
        FOREIGN KEY (model) REFERENCES Product(model)
    );

    CREATE TABLE Printer (
        model INT PRIMARY KEY,
        color BOOLEAN,
        type VARCHAR(255),
        price FLOAT,
        FOREIGN KEY (model) REFERENCES Product(model)
    );

    \end{lstlisting}

    \bigskip

    \begin{mdframed}
        \underline{\textbf{Correct Solution:}}

        \bigskip

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Product (
        maker CHAR(30),
        model INT PRIMARY KEY,
        type VARCHAR(255)
    );

    CREATE TABLE PC (
        model INT PRIMARY KEY,
        speed FLOAT,
        ram INT,
        hd INT,
        price FLOAT,
        FOREIGN KEY (model) REFERENCES Product(model)
            ON DELETE CASCADE
            ON UPDATE CASCADE
    );

    CREATE TABLE Laptop (
        model INT PRIMARY KEY,
        speed FLOAT,
        ram INT,
        hd INT,
        screen INT,
        price FLOAT,
        FOREIGN KEY (model) REFERENCES Product(model)
            ON DELETE CASCADE
            ON UPDATE CASCADE
    );

    CREATE TABLE Printer (
        model INT PRIMARY KEY,
        color BOOLEAN,
        type VARCHAR(255),
        price FLOAT,
        FOREIGN KEY (model) REFERENCES Product(model)
            ON DELETE CASCADE
            ON UPDATE CASCADE
    );

    \end{lstlisting}


    \end{mdframed}

    \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Classes (
        class CHAR(255) PRIMARY KEY,
        type CHAR(2),
        country CHAR(255),
        numGuns INT,
        bore INT,
        displacement INT
    );

    CREATE TABLE Ships (
        name CHAR(255) PRIMARY KEY,
        class CHAR(255),
        launched DATE,
        FOREIGN KEY (class) REFERENCES Classes(class)
            ON DELETE CASCADE
            ON UPDATE CASCADE
    );

    CREATE TABLE Battles (
        name CHAR(255) PRIMARY KEY,
        date DATE
    );

    CREATE TABLE Outcome (
        ship CHAR(255),
        battle CHAR(255),
        result CHAR(7),
        PRIMARY KEY (ship, battle, result),
        FOREIGN KEY (battle) REFERENCES Battles(name),
            ON DELETE CASCADE
            ON UPDATE CASCADE
        FOREIGN KEY (ship) REFERENCES Ships(name),
            ON DELETE CASCADE
            ON UPDATE CASCADE
    );

    \end{lstlisting}

    \item

    \begin{enumerate}[a)]
        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Classes (
        class CHAR(255) PRIMARY KEY,
        type CHAR(2),
        country CHAR(255),
        numGuns INT,
        bore FLOAT(3),
        displacement INT
    );

    CREATE TABLE Ships (
        name CHAR(255) PRIMARY KEY,
        class CHAR(255),
        launched DATE,
        FOREIGN KEY (class) REFERENCES Classes(class)
            ON DELETE CASCADE
            ON UPDATE CASCADE
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Battles (
        name CHAR(255) PRIMARY KEY,
        date DATE
    );

    CREATE TABLE Outcome (
        ship CHAR(255),
        battle CHAR(255),
        result CHAR(7),
        PRIMARY KEY (ship, battle, result),
        FOREIGN KEY (battle) REFERENCES Battles(name),
            ON DELETE CASCADE
            ON UPDATE CASCADE
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Ships (
        name CHAR(255) PRIMARY KEY,
        class CHAR(255),
        launched DATE,
        FOREIGN KEY (class) REFERENCES Classes(class)
            ON DELETE CASCADE
            ON UPDATE CASCADE
    );

    CREATE TABLE Outcome (
        ship CHAR(255),
        battle CHAR(255),
        result CHAR(7),
        PRIMARY KEY (ship, battle, result),
        FOREIGN KEY (battle) REFERENCES Battles(name),
            ON DELETE CASCADE
            ON UPDATE CASCADE
        FOREIGN KEY (ship) REFERENCES Ships(name),
            ON DELETE CASCADE
            ON UPDATE CASCADE
    );
    \end{lstlisting}

    \end{enumerate}

    \item

    \begin{enumerate}[a)]
        \item

    \begin{lstlisting}[language=SQL]
    Movies(title, year, length, genre, studioName, producerC#)

    CREATE TALBE Movies (
        ...
        year INT PRIMARY KEY CHECK (year >= 1915),
        ...
    );
    \end{lstlisting}

        \bigskip

        \underline{\textbf{Notes:}}

        \bigskip

        \begin{itemize}
            \item CHECK Constraints
            \begin{itemize}
                \item sets conditions that must hold for every value of an attribute

        \begin{lstlisting}[language=SQL]
        // Example 1
        Studio(name, address, pressC#)


        CREATE TALBE Studio (
            ...
            presC# INT REFERENCES MovieExec(cer#)
                CHECK (presC# >= 10000)
        );

        // Example 2
        MovieStar(name, address, gender, birthdate)

        CREATE TALBE MovieStar (
            ...
            gender CHAR(1) CHECK (gender IN ('F', 'M')),
            ...
        );
        \end{lstlisting}
            \end{itemize}
        \end{itemize}

        \item

    \begin{lstlisting}[language=SQL]
    Movies(title, year, length, genre, studioName, producerC#)

    CREATE TALBE Movies (
        ...
        length INT CHECK (length > 250 AND length < 60),
        ...
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    Movies(title, year, length, genre, studioName, producerC#)

    CREATE TALBE Movies (
        ...
        studioName VARCHAR(255) CHECK (studioName IN ('Disney', 'Fox', 'MGM', 'Paramount')),
        ...
    );
    \end{lstlisting}

    \end{enumerate}

    \item

    \begin{enumerate}[a)]
        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Laptop (
        ...
        speed FLOAT CHECK (speed >= 2.0),
        ...
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Printer (
        ...
        type VARCHAR(255) CHECK (type IN ('laser', 'ink-jet', 'bubble-jet')),
        ...
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Product (
        maker CHAR(30),
        model INT PRIMARY KEY,
        type VARCHAR(255) CHECK (type IN ('pc', 'laptop', 'printer'))
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Product (
        ...
        model INT PRIMARY KEY CHECK (type IN (
            (SELECT model FROM PC)
            UNION
            (SELECT model FROM Laptop)
            UNION
            (SELECT model FROM Printer)
        )),
        ...
    );
    \end{lstlisting}

    \end{enumerate}

    \item

    \begin{enumerate}[a)]
        \item
    \begin{lstlisting}[language=SQL]
    CREATE TABLE MovieStar (
        name CHAR(255) PRIMARY KEY,
        address VARCHAR(255),
        gender CHAR(1),
        birthdate DATE,
        CHECK (strftime('%Y', birthdate) <= (
            SELECT movieYear FROM StarsIn WHERE starName = name
        ))
    );

    CREATE TABLE StarsIn (
        movieTitle VARCHAR(255) PRIMARY KEY,
        movieYear INT PRIMARY KEY,
        starName VARCHAR(255) PRIMARY KEY,
        CHECK (movieYear >= (
            SELECT strftime('%Y', birthdate) FROM MovieStar WHERE starName = name
        ))
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Studio (
        name CHAR(255) PRIMARY KEY,
        address VARCHAR(255),
        presC# INT,
        UNIQUE KEY (address)
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE MovieStar (
        name CHAR(255) PRIMARY KEY,
        address VARCHAR(255),
        gender CHAR(1),
        birthdate DATE,
        CHECK (name NOT IN (
            SELECT name FROM MovieExec
        ))
    );

    CREATE TABLE MovieExec (
        name CHAR(255) PRIMARY KEY,
        address VARCHAR(255),
        cert# INT,
        netWorth INT,
        CHECK (name NOT IN (
            SELECT name FROM MovieStar
        ))
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Studio (
        name CHAR(30) PRIMARY KEY,
        address VARCHAR(255),
        presC# INT REFERENCES MovieExeC(cert#),
        CHECK (name IN (
            SELECT studioName FROM Movies
        ))
    );

    CREATE TABLE Movies (
        title CHAR(30) PRIMARY KEY,
        year INT PRIMARY KEY,
        length INT,
        genre VARCHAR(255),
        studioName VARCHAR(255),
        producerC# PRIMARY KEY,
        CHECK (studioName IN (
            SELECT name FROM Studio
        ))
    );
    \end{lstlisting}
    \end{enumerate}

    \item

    \begin{enumerate}[a)]
        \item
    \begin{lstlisting}[language=SQL]
    CREATE TABLE PC (
        model INT PRIMARY KEY,
        speed FLOAT,
        ram INT,
        hd INT,
        price FLOAT,
        CHECK (speed < 2.0 AND price <= 600)
    );
    \end{lstlisting}

        \item
    \begin{lstlisting}[language=SQL]
    CREATE TABLE Laptop (
        model INT PRIMARY KEY,
        speed FLOAT,
        ram INT,
        hd INT,
        screen INT,
        price FLOAT,
        CHECK (screen < 15 AND (hd >= 40 OR price < 1000))
    );
    \end{lstlisting}
    \end{enumerate}

    \item

    \begin{enumerate}[a)]
        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Classes (
        class CHAR(255) PRIMARY KEY,
        type CHAR(2),
        country CHAR(255),
        numGuns INT,
        bore INT,
        displacement INT,
        CHECK (bore <= 16)
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Classes (
        class CHAR(255) PRIMARY KEY,
        type CHAR(2),
        country CHAR(255),
        numGuns INT,
        bore INT,
        displacement INT,
        CHECK (numGuns > 9 AND bore <= 14)
    );
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    CREATE TABLE Ships (
        name CHAR(255) PRIMARY KEY,
        class CHAR(255),
        launched INT,
        CHECK (launched <= (
            SELECT strftime('%Y', date) FROM Battles
            INNER JOIN Outcomes ON Battles.name = Outcomes.battle
            WHERE ship = Ships.name
        ))
    );
    \end{lstlisting}

    \end{enumerate}

    \item $gender \neq NULL$
    \item

    \begin{enumerate}[a)]
        \item ALTER TABLE Movies ADD PRIMARY KEY(title, year);
        \item
    \begin{lstlisting}[language=SQL]
    ALTER TABLE Movies ADD CHECK (producerC# IN (
        SELECT cert# IN MovieExec
    ));
    \end{lstlisting}

        \bigskip

        \begin{mdframed}
            \underline{\textbf{Correct Solution:}}

            \bigskip

    \begin{lstlisting}[language=SQL]
    ALTER TABLE MovieExec ADD FOREIGN KEY (producerC#) REFERENCES MovieExec(cert#)
    \end{lstlisting}

        \end{mdframed}

        \item

    \begin{lstlisting}[language=SQL]
    ALTER TABLE Movies ADD CHECK (NOT (length < 60 OR length > 250));
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    ALTER TABLE MovieExec ADD CHECK (name NOT IN (
        SELECT name FROM MovieStar
    ));

    ALTER TABLE MovieStar ADD CHECK (name NOT IN (
        SELECT name FROM MovieExec
    ));
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    ALTER TABLE Studios ADD UNIQUE (address);
    \end{lstlisting}

    \end{enumerate}

    \item

    \begin{enumerate}[a)]
        \item

    \begin{lstlisting}[language=SQL]
    ALTER TABLE Classes ADD PRIMARY KEY (class, country);
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    ALTER TABLE Outcomes ADD FOREIGN KEY (battle) REFERENCES Battles(name);
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    ALTER TABLE Outcomes ADD FOREIGN KEY (ship) REFERENCES Ships(name);
    \end{lstlisting}

        \item

    \begin{lstlisting}[language=SQL]
    ALTER TABLE Classes ADD CHECK (NOT (numGuns > 14));
    \end{lstlisting}

    \end{enumerate}

\end{enumerate}

\end{document}